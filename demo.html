<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-5">

            <!-- PRODUCT SUMMARY -->
            <div id="productSummary" class="card mb-3">
                <div class="card-body">
                    <h6>üõí Your Order</h6>
                    <p class="mb-1"><strong>Product:</strong> <span id="pTitle"></span></p>
                    <p class="mb-0"><strong>Price:</strong> ‚Çπ<span id="pPrice"></span></p>
                </div>
            </div>

            <!-- CHECKOUT FORM -->
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="mb-3">Billing Details</h5>

                    <form class="form-checkout">
                        <input id="first-name" class="form-control mb-2" placeholder="First Name" required>
                        <input id="last-name" class="form-control mb-2" placeholder="Last Name" required>
                        <input id="phone" class="form-control mb-2" placeholder="Phone" required>
                        <input id="email" type="email" class="form-control mb-2" placeholder="Email" required>
                        <input id="address" class="form-control mb-3" placeholder="Address" required>

                        <button type="submit" class="btn btn-primary w-100">
                            Place Order & Pay
                        </button>
                    </form>

                </div>
            </div>

        </div>
    </div>
</div>

<!-- Razorpay -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
/* ============================
   LOAD PRODUCT DATA
============================ */
const title = localStorage.getItem("product_title");
const price = localStorage.getItem("product_price");

document.getElementById("pTitle").textContent = title;
document.getElementById("pPrice").textContent = price;

console.log("üõí Product Loaded:");
console.log("Title:", title);
console.log("Price:", price);

/* ============================
   CHECKOUT SUBMIT
============================ */
document.querySelector(".form-checkout").addEventListener("submit", function (e) {
    e.preventDefault();

    const checkoutData = {
        firstName: first-name.value,
        lastName: last-name.value,
        phone: phone.value,
        email: email.value,
        address: address.value
    };

    console.log("üßæ Checkout Details:");
    console.table(checkoutData);

    startPayment(checkoutData);
});

/* ============================
   RAZORPAY PAYMENT
============================ */
function startPayment(user) {

    const options = {
        key: "rzp_test_xxxxxxxxxx", // ‚úÖ TEST KEY ONLY
        amount: price * 100,
        currency: "INR",

        name: "Ecomus Store",
        description: title,

        method: {
            upi: { flow: "intent" },
            card: false,
            netbanking: false,
            wallet: false
        },

        prefill: {
            name: user.firstName + " " + user.lastName,
            email: user.email,
            contact: user.phone
        },

        notes: {
            address: user.address,
            product: title
        },

        handler: function (response) {
            console.log("‚úÖ PAYMENT SUCCESS");
            console.log("Payment ID:", response.razorpay_payment_id);
            console.log("Amount Paid:", price);

            alert("Payment Successful ‚úÖ");
            // localStorage.clear(); // optional
        },

        modal: {
            ondismiss: function () {
                console.log("‚ùå Payment Cancelled");
            }
        },

        theme: { color: "#0d6efd" }
    };

    const rzp = new Razorpay(options);
    rzp.open();
}
</script>

</body>
</html>
